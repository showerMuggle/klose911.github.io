#+TITLE: LVM 入门
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="css/main.css" />
#+OPTIONS: num:nil timestamp:nil ^:nil 

#+begin_example
引用 Wikipedia:Logical Volume Manager  的解释
#+end_example
LVM 是一种可用在 _Linux 内核_ 的 *逻辑分卷* 管理器，可用于管理磁盘驱动器或其他类似的大容量存储设备
* LVM基本组成

LVM利用Linux内核的 _device-mapper_ 功能来实现 *存储系统的虚拟化* （系统分区独立于底层硬件）

#+begin_example
  通过LVM：

  可以实现存储空间的抽象化并在上面建立虚拟分区（virtual partitions）
  可以更简便地扩大和缩小分区
  可以增删分区时无需担心某个硬盘上没有足够的连续空间

  避免为正在使用的磁盘重新分区的麻烦、为调整分区而不得不移动其他分区的不便
#+end_example

LVM的基本组成部分如下：
+ *物理卷*  ( _PV_ )：一个可供存储LVM的块设备，，它包含一个 *特殊的LVM头* 
#+begin_example
例如: 一块硬盘, 一个MBR或GPT分区, 一个回环文件, 一个被内核映射的设备 (例如 dm-crypt)
#+end_example
+ *卷组* ( _VG_ ) :   _物理卷_ 的一个 _组_ ，作为 *存放* _逻辑卷_ 的 *容器* 
+ *逻辑卷* ( _LV_ ):  逻辑卷存放在一个 _卷组_ 中并由物理块组成
#+begin_example
  一个类似于物理设备的块设备

  例如，可以直接在它上面创建一个文件系统文件系统
#+end_example
+ *物理块* ( _PE_ )：一个 _卷组_ 中 *最小的连续区域* (默认为 _4 MiB_ )，多个物理块将被分配给一个逻辑卷
#+begin_example
  可以把它看成物理卷的一部分，这部分可以被分配给一个逻辑卷
#+end_example

示例:

#+begin_example
  '''物理硬盘'''

    硬盘1 (/dev/sda):
       _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
      |分区1 50GB (物理卷)           |分区2 80GB (物理卷)            |
      |/dev/sda1                    |/dev/sda2                     |
      |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _|_ _ _ _ _ _ _ _ _ _ _ _ _ _ __|

    硬盘2 (/dev/sdb):
       _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
      |分区1 120GB (物理卷)                         |
      |/dev/sdb1                                         |
      | _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _   |

   '''LVM逻辑卷'''
 
     卷组（Volume Group1） (/dev/MyVolGroup/ = /dev/sda1 + /dev/sda2 + /dev/sdb1):
	_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ __ 
       |逻辑卷1 15GB                  |逻辑卷2 35GB                        |逻辑卷3 200GB                         |
       |/dev/MyVolGroup/rootvol        |/dev/MyVolGroup/homevol             |/dev/MyVolGroup/mediavol              |
       |_ _ _ _ _ _ _ _ _ _ _ _ _ _ __|_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ __ |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _|
#+end_example
* 优点
比起普通的硬盘分区管理方式，LVM更富于灵活性：
+ 将多块硬盘看作一块大硬盘
+ 使用逻辑卷（LV），可以创建跨越众多硬盘空间的分区
+ 可以创建小的逻辑卷（LV），在空间不足时再动态调整它的大小
+ 在调整逻辑卷（LV）大小时可以不用考虑逻辑卷在硬盘上的位置，不用担心没有可用的连续空间
+ 可以在线对逻辑卷（LV）和卷组（VG）进行创建、删除、调整大小等操作
#+begin_example
不过LVM上的文件系统也需要重新调整大小，好在某些文件系统（例如ext4）也支持在线操作
#+end_example
+ 无需重新启动服务，就可以将服务中用到的逻辑卷（LV）在线/动态迁移至别的硬盘上
+ 允许创建快照，可以保存文件系统的备份，同时使服务的下线时间降低到最小
+ 支持各种设备映射目标（device-mapper targets），包括透明文件系统加密和缓存常用数据
#+begin_example
  这将允许你创建一个包含一个或多个磁盘、并用LUKS加密的系统

  使用LVM on top 可轻松地管理和调整这些独立的加密卷 （例如. /, /home, /backup等) 并免去开机时多次输入密钥的麻烦
#+end_example
* 缺点
+ 在系统设置时需要更复杂的额外步骤
+ Windows系统并不支持LVM，若使用双系统，将无法在Windows上访问LVM分区
* 准备
确保已安装 _lvm2_ 软件包 
* 在LVM上安装 Linux 



