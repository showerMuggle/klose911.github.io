#+TITLE: Kubectl命令
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="../../css/main.css" />
#+HTML_LINK_HOME: command.html
#+OPTIONS: num:nil timestamp:nil ^:nil

Kubernetes提供的kubectl命令是与集群交互最直接的方式，kubectl命令参考图如下：


#+ATTR_HTML: image :width 70% 
[[file:../../pic/kubernetes-kubectl-cheatsheet.png]]

Kubectl的子命令主要分为8个类别：
+ 基础命令（初学者都会使用的）
+ 基础命令（中级）
+ 部署命令
+ 集群管理命令
+ 故障排查和调试命令
+ 高级命令
+ 设置命令
+ 其他命令

#+BEGIN_EXAMPLE
  熟悉这些命令有助于操作和管理kubernetes集群
#+END_EXAMPLE

* 配置
** 命令行提示

   #+ATTR_HTML: image :width 70% 
   [[file:../../pic/tools-to-supercharge-kubectl.jpg]]

   + [[file:https:/github.com/ahmetb/kubectx][kubectx]]：用于切换kubernetes context
   + [[file:https:/github.com/jonmosco/kube-ps1][kube-ps1]]：为命令行终端增加$PROMPT字段
   + [[file:https:/github.com/cloudnativelabs/kube-shell][kube-shell]]：交互式带命令提示的kubectl终端

     全部配置完成后的kubectl终端如下图所示：

   #+ATTR_HTML: image :width 70% 
   [[file:../../pic/supercharged-kubectl.jpg]]
*** kube-shell
    #+begin_example
      开源项目kube-shell可以为kubectl提供自动的命令提示和补全，使用起来特别方便
    #+end_example
    Kube-shell有以下特性：
    + 命令提示，给出命令的使用说明
    + 自动补全，列出可选命令并可以通过tab键自动补全，支持模糊搜索
    + 高亮
    + 使用tab键可以列出可选的对象
    + vim模式

      安装：
      #+begin_src sh 
	pip install kube-shell --user -U
      #+end_src

** 身份认证
   Kubernetes中存在三种安全认证方式：
   + CA证书：API server与其它几个组件之间都是通过这种方式认证的
   + HTTP base：在API server的启动参数中指定的--token-auth-file=/etc/kubernetes/token.csv文件中明文的用户、组、密码和UID配置
   + bearer token：HTTP请求中header中传递的Autorization:Bearer token，这个token通常保存在创建角色跟serviceaccount绑定的时候生成的secret中

   kubectl通过读取 _kubeconfig_ 文件中的配置信息在向API server发送请求的时候同时传递认证信息，同时支持CA证书和bearer token的认证方式

** 命令自动补全
   #+begin_example
       建议使用oh-my-zsh，增加对kubectl命令自动补全支持

   #+end_example
   修改~/.zshrc文件，增加如下两行：

   #+begin_example
     plugins=(kubectl)
     source <(kubectl completion zsh)
   #+end_example

   保存后重启终端即可生效
